<template>
	<div class="page">
		<div class="navbar">
			<div class="navbar-inner sliding">
				<div class="left">
					<a href="#" class="link back">
						<i class="icon icon-back"></i>
						<span class="ios-only">Back</span>
					</a>
				</div>
				<div class="title">Tasks</div>
				<div class="right">
				<a class="link icon-only searchbar-enable" data-searchbar=".searchbar-my-modules">
				  <i class="icon material-icons md-only">perm_contact_calendar</i>
				  <i class="icon f7-icons ios-only">calendar</i>
				</a>
			  </div>
			</div>
		</div>
		<div class="page-content">
						

			<div class="block">

				<p class="segmented"></p>
			
			</div> 
			
			<div class="swiper-container">
			<div class="swiper-wrapper">
			
			<div class="swiper-slide">
				<div class="list">
					<ul>
					{{zero_pending_tasks}}
					{{#each pending_tasks}}
						<li>
						  <a href="#" class="item-link item-content" data-task-id="{{this.id}}">
							<div class="item-media"><img src='{{js "return file_server + 'user/' + this.assigned_by_name.toLowerCase().replace(/ /g, '-') + '.jpg'"}}' alt="this.assigned_by_name"/></div>
							<div class="item-inner">
							  <div class="item-title">
								<div class="item-header">{{js 'date=new Date(this.timestamp_created); return this.assigned_by_name + "<i></i>" + ("0" + date.getDate()).slice(-2) + "/" + ("0" + (date.getMonth() + 1)).slice(-2) + "/" + date.getFullYear() + "<i></i>" + ("0" + date.getHours()).slice(-2) + ":" + ("0" + date.getMinutes()).slice(-2) +" "+ this.timestamp_created.split(" ")[2] '}}</div>
								{{this.title}}
							  </div>
							</div>
						  </a>
						</li>
					{{/each}}
					</ul>
				</div>
			</div>
			
			<div class="swiper-slide">
				<div class="list">
					<ul>
					{{zero_wip_tasks}}
					{{#each wip_tasks}}
						<li>
						  <a href="#" class="item-link item-content" data-task-id="{{this.id}}">
							<div class="item-media"><img src='{{js "return file_server + 'user/' + this.assigned_by_name.toLowerCase().replace(/ /g, '-') + '.jpg'"}}' alt="this.assigned_by_name"/></div>
							<div class="item-inner">
							  <div class="item-title">
								<div class="item-header">{{js 'date=new Date(this.timestamp_created); return this.assigned_by_name + "<i></i>" + ("0" + date.getDate()).slice(-2) + "/" + ("0" + (date.getMonth() + 1)).slice(-2) + "/" + date.getFullYear() + "<i></i>" + ("0" + date.getHours()).slice(-2) + ":" + ("0" + date.getMinutes()).slice(-2) +" "+ this.timestamp_created.split(" ")[2] '}}</div>
								{{this.title}}
							  </div>
							</div>
						  </a>
						</li>
					{{/each}}
					</ul>
				</div>
			</div>

			<div class="swiper-slide">
				<div class="list">
					<ul>
					{{zero_completed_tasks}}
					{{#each completed_tasks}}
						<li>
						  <a href="#" class="item-link item-content" data-task-id="{{this.id}}">
							<div class="item-media"><img src='{{js "return file_server + 'user/' + this.assigned_by_name.toLowerCase().replace(/ /g, '-') + '.jpg'"}}' alt="this.assigned_by_name"/></div>
							<div class="item-inner">
							  <div class="item-title">
								<div class="item-header">{{js 'date=new Date(this.timestamp_created); return this.assigned_by_name + "<i></i>" + ("0" + date.getDate()).slice(-2) + "/" + ("0" + (date.getMonth() + 1)).slice(-2) + "/" + date.getFullYear() + "<i></i>" + ("0" + date.getHours()).slice(-2) + ":" + ("0" + date.getMinutes()).slice(-2) +" "+ this.timestamp_created.split(" ")[2] '}}</div>
								{{this.title}}
							  </div>
							</div>
						  </a>
						</li>
					{{/each}}
					</ul>
				</div>
			</div>
			
			</div>
			</div>
			
		</div>
	</div>
</template>

<style scoped>

.item-media img {
	width:36px;
	height:36px;
	border-radius:36px;
	-moz-box-shadow: 0px 0px 1px 0px #000;
	-webkit-box-shadow: 0px 0px 1px 0px #000;
	box-shadow: 0px 0px 1px 0px #000;
}

.swiper-container {
  width: 100%;
  height: auto;
}

.swiper-container {
    min-height: 100%;
}

.swiper-slide .list{
	margin: 0;
}

.swiper-pagination-bullet{
	opacity: 1!important;
}

.swiper-pagination-bullet-active{
	color: #fff!important;
}

.item-header i:before {
	content: '';
	width: 4px;
	height: 4px;
	border-radius: 50%;
	display: inline-block;
	vertical-align: middle;
	margin: -1px 8px 0 8px;
	background: #757575;
}

</style>

<script>

file_server = app.data.config.file_server;

return	{
	data: function () {
        return {
		zero_pending_tasks: function(){ if(app.form.getFormData('jcp_plus__tasks').filter(function(a){return a.status=='Pending'}).length==0){ return '<li> <div class="item-content"> <div class="item-media"><img src="' + file_server + 'user/' + app.data.warrior.reporting_to_name.toLowerCase().replace(/ /g, '-') + '.jpg" alt="' + app.data.warrior.reporting_to_name+'"/></div> <div class="item-inner"> <div class="item-title"> <div class="item-header">'+app.data.warrior.reporting_to_name+'</div> Well done, '+ app.data.warrior.name +'! You have 0 pending tasks. </div> </div> </div> </li>'}else{return ''}},
		zero_wip_tasks: function(){ if(app.form.getFormData('jcp_plus__tasks').filter(function(a){return a.status=='WIP'}).length==0){ return '<li> <div class="item-content"> <div class="item-media"><img src="' + file_server + 'user/' + app.data.warrior.reporting_to_name.toLowerCase().replace(/ /g, '-') + '.jpg" alt="' + app.data.warrior.reporting_to_name+'"/></div> <div class="item-inner"> <div class="item-title"> <div class="item-header">'+app.data.warrior.reporting_to_name+'</div> Yo, '+ app.data.warrior.name +'! You have 0 work-in-progress tasks. </div> </div> </div> </li>'}else{return ''}},
		zero_completed_tasks: function(){ if(app.form.getFormData('jcp_plus__tasks').filter(function(a){return a.status=='Completed'}).length==0){ return '<li> <div class="item-content"> <div class="item-media"><img src="' + file_server + 'user/' + app.data.warrior.reporting_to_name.toLowerCase().replace(/ /g, '-') + '.jpg" alt="' + app.data.warrior.reporting_to_name+'"/></div> <div class="item-inner"> <div class="item-title"> <div class="item-header">'+app.data.warrior.reporting_to_name+'</div> Yo, '+ app.data.warrior.name +'! You have 0 completed tasks. </div> </div> </div> </li>'}else{return ''}},
		pending_tasks: app.form.getFormData('jcp_plus__tasks').filter(function(a){return a.status=='Pending'}),
		wip_tasks: app.form.getFormData('jcp_plus__tasks').filter(function(a){return a.status=='WIP'}),
		completed_tasks: app.form.getFormData('jcp_plus__tasks').filter(function(a){return a.status=='Completed'}),
        }
    },
	on: {
		pageInit: function(){
						
			$('.item-input-wrap i').click(function(){
				app.dialog.alert('SAN is visible only to you.', 'Yo!');
			})			
			
			initialSlide = 0;
			initialScroll = '';
			initialOpen = '';
			if(this.$route.query.goto){initialSlide=this.$route.query.goto}
			if(this.$route.query.focus){initialScroll=this.$route.query.focus}
			if(this.$route.query.open){initialOpen=this.$route.query.open}

var swiper = new Swiper('.swiper-container', {
	  initialSlide: initialSlide,
      autoHeight: true,
      spaceBetween: 20,
	  mousewheel: true,
      keyboard: {
        enabled: true,
      },
	  pagination: {
        el: '.segmented',
        clickable: true,
		renderBullet: function (index, className) {
			label_0 = 'Pending';
			label_1 = 'In-Progress';
			label_2 = 'Completed';
			return '<button class="button button-outline bg-color-white ' +className+'">'+window['label_'+index]+'</button>';
        },
      },
	  on: {
		init: function(){
			setTimeout(function(){
			swiper.updateAutoHeight();
			$('.swiper-pagination-bullet-active').removeClass('bg-color-white');
			if(initialScroll){
				$('.page-content').scrollTop( $('.'+initialScroll).offset().top - 234 , 0)
				$('.'+initialScroll).addClass('highlight');
			}
			}, 1);
		},
		slideChange: function () {
			$('.swiper-pagination-bullet').addClass('bg-color-white');
			$('.swiper-pagination-bullet-active').removeClass('bg-color-white');
		},
	  },
    });
		},
	},
    methods: {
	
	},
  }
</script>

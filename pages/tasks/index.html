<template>
	<div class="page">
	
		<div class="navbar">
			<div class="navbar-inner sliding">
				<div class="left">
					<a href="#" class="link back">
						<i class="icon icon-back"></i>
						<span class="ios-only">Back</span>
					</a>
				</div>
				<div class="title">Tasks<span class="subtitle"></span></div>
				<div class="right">
				<a class="link icon-only searchbar-enable" data-searchbar=".searchbar-tasks">
				  <i class="icon material-icons md-only">search</i>
				  <i class="icon f7-icons ios-only">search_strong</i>
				</a>
			  </div>
			  
			   <form data-search-container=".search-list" data-search-in=".item-inner" class="searchbar searchbar-expandable searchbar-tasks searchbar-init">
				<div class="searchbar-inner">
				  <div class="searchbar-input-wrap">
					<input type="search" placeholder="Search tasks.."/>
					<i class="searchbar-icon"></i>
					<span class="input-clear-button"></span>
				  </div>
				  <span class="searchbar-disable-button">Cancel</span>
				</div>
			  </form>

			</div>
		</div>
		
		<div class="page-content">
			
			<div class="searchbar-backdrop"></div>
		
			<div class="block"><p class="segmented"></p></div> 

			<div class="list simple-list searchbar-not-found"><ul><li>Sorry, we couldn't find any tasks for this search.</li></ul></div>
			
			<div class="swiper-container">
			<div class="swiper-wrapper">

			<div class="swiper-slide tasks-assigned-to-you">
				<div class="list searchbar-found search-list">
					<ul>
					{{#if zero_tasks_assigned_to_you}}
						<li class="zero-tasks"><div class="img" style="background-image:url({{$root.config.file_server}}user/{{$root.warrior.reporting_to_email}}.jpg)"></div><div class="zero-tasks-title">{{$root.warrior.reporting_to_name}} <small>says</small><br>Dear {{$root.warrior.name}},<br>You don't have any active tasks.<br>Come over, let's talk.</div></li>
					{{else}}
					{{#each tasks_assigned_to_you}}
							<li>
							  <a data-goto="view/?id={{this.id}}" class="item-link item-content">
							  	<div class="item-media"><div class="img" style="background-image:url({{../$root.config.file_server}}user/{{this.assigned_by_email}}.jpg)"></div></div>
								<div class="item-inner">
								  <div class="item-title">
									<div class="item-header">{{this.assigned_by_name}}<i></i>{{t7helper_formatedDate this.timestamp_created 0}}</div>
									{{this.title}}
								  </div>
								  <div class="item-after"><span class="badge color-{{this.status}}">{{this.status}}</span></div>
								</div>
							  </a>
							</li>
						{{/each}}
					{{/if}}
					</ul>
				</div>
			</div>
			
			
			<div class="swiper-slide tasks-created-by-you">
				<div class="list searchbar-found search-list">
					<ul>
					{{#if zero_tasks_created_by_you}}
						<li class="zero-tasks"><div class="img" style="background-image:url({{$root.config.file_server}}user/{{$root.warrior.reporting_to_email}}.jpg)"></div><div class="zero-tasks-title">{{$root.warrior.reporting_to_name}} <small>says</small><br>Dear {{$root.warrior.name}},<br>You have not created any tasks for others.<br><br><button class="button button-small button-raised button-fill">Create Task for Others</button><small>Tasks created by you will get assigned to others post my approval.</small></div></li>
					{{else}}
					{{#each tasks_created_by_you}}
							<li>
							  <a data-goto="view/?id={{this.id}}" class="item-link item-content">
							  	<div class="item-media"><div class="img" style="background-image:url({{../$root.config.file_server}}user/{{this.assigned_by_email}}.jpg)"></div></div>
								<div class="item-inner">
								  <div class="item-title">
									<div class="item-header">{{this.assigned_by_name}}<i></i>{{t7helper_formatedDate this.timestamp_created 0}}</div>
									{{this.title}}
								  </div>
								  <div class="item-after"><span class="badge color-{{this.status}}">{{this.status}}</span></div>
								</div>
							  </a>
							</li>
						{{/each}}
					{{/if}}
					</ul>
				</div>
			</div>


			<div class="swiper-slide your-team-tasks">
				<div class="list searchbar-found search-list">

					<ul>
						<li class="zero-tasks">
							<div class="preloader color-{{$root.settings.color}}" style="width:44px;height:44px"></div>
							<p>Sorry! we couldn't load your team's tasks. Please retry.</p>
							<button @click="get_team_tasks" class="button button-raised button-fill">Retry</button>
						</li>
					</ul>
			
				</div>
			</div>
			
			</div>
			</div>
			
		</div>
	</div>
</template>

<style scoped>

.item-media .img, .zero-tasks .img {
	width:36px;
	height:36px;
	background-size: 100% 100%;
	border-radius:50%;
	-moz-box-shadow: 0px 0px 2px 0px #000;
	-webkit-box-shadow: 0px 0px 2px 0px #000;
	box-shadow: 0px 0px 2px 0px #000;
	background-color: #ddd;
}

.zero-tasks {
	text-align: center;
	line-height: 36px;
	padding: 60px 0;
}

.zero-tasks .img {
	margin: 0 auto 10px auto;
}

.zero-tasks small {
	color: grey;
}

.zero-tasks .button{
	margin: 0 auto;
}

.zero-tasks p{
	margin-top: 0px;
}

.swiper-slide.tasks-created-by-you .zero-tasks .button{
	max-width: 200px;
}

.swiper-slide.your-team-tasks .zero-tasks .button{
	max-width: 100px;
}

.swiper-slide.your-team-tasks .zero-tasks .button, .swiper-slide.your-team-tasks .zero-tasks p {
	display: none;
}

.swiper-container {
  width: 100%;
  height: auto;
}

.swiper-container {
    min-height: 88%;
}

.swiper-slide .list{
	margin-top: 0;
}

.swiper-pagination-bullet{
	opacity: 1!important;
}

.swiper-pagination-bullet-active{
	color: #fff!important;
}

.item-header i:before {
	content: '';
	width: 4px;
	height: 4px;
	border-radius: 50%;
	display: inline-block;
	vertical-align: middle;
	margin: -1px 8px 0 8px;
	background: #757575;
}

.searchbar-found.toggle-swiper-slides .swiper-wrapper{
	display: inline!important;
}

.searchbar-found.toggle-swiper-slides .swiper-wrapper .list .item-inner:after {
	content: ''!important;
    position: absolute!important;
    background-color: rgba(0,0,0,.12)!important;
    display: block!important;
    z-index: 15!important;
    top: auto!important;
    right: auto!important;
    bottom: 0!important;
    left: 0!important;
    height: 1px!important;
    width: 100%!important;
    -webkit-transform-origin: 50% 100%!important;
    transform-origin: 50% 100%!important;
}

.searchbar-found.toggle-swiper-slides .swiper-wrapper .hidden-by-searchbar:after,
.searchbar-found.toggle-swiper-slides .swiper-wrapper .list ul:before,
.searchbar-found.toggle-swiper-slides .swiper-wrapper .list ul:after {
	display:none!important;
}

.searchbar-backdrop {
	background: rgba(0,0,0,.1);
}

#tasks-calendar-range {
	background: none;
    border: 0;
    color: #fff;
    font-size: 13px;
	padding: 0;
	margin: 0;
}

.zero-tasks .img {
	width: 80px;
	height: 80px;
	margin: 0 auto 15px auto;
}


.color-Pending {background:red}
.color-WIP {background:orange}
.color-Completed {background:green}

.item-after .badge {
    width: 68px;
	font-size: 12px;
}

</style>

<script>

file_server = app.data.config.file_server;

return	{
	data: function () {
        return {
			config: app.data.config,
			warrior: app.data.warrior,
			zero_tasks_assigned_to_you: function(){if(app.form.getFormData('tasks').filter(function(a){return a.assigned_to_email==app.data.warrior.email}).length==0){return 'zero'}else{return null}},
			tasks_assigned_to_you: app.form.getFormData('tasks').filter(function(a){return a.assigned_to_email==app.data.warrior.email}),
			zero_tasks_created_by_you: function(){if(app.form.getFormData('tasks').filter(function(a){return a.assigned_by_email==app.data.warrior.email}).length==0){return 'zero'}else{return null}},
			tasks_created_by_you: app.form.getFormData('tasks').filter(function(a){return a.assigned_by_email==app.data.warrior.email}),
		}
    },
	on: {
		pageInit: function(){
			var self = this;
			var today = new Date();
			var app = self.$app;
			var $ = self.$;
			
			initialSlide = 0;
			initialScroll = '';
			initialOpen = '';
			if(this.$route.query.goto){initialSlide=this.$route.query.goto}
			if(this.$route.query.focus){initialScroll=this.$route.query.focus}
			if(this.$route.query.open){initialOpen=this.$route.query.open}

var swiper = new Swiper('.swiper-container', {
	  initialSlide: initialSlide,
      autoHeight: true,
      spaceBetween: 20,
	  mousewheel: true,
      keyboard: {enabled: true,},
	  pagination: {
        el: '.segmented',
        clickable: true,
		renderBullet: function (index, className) {
			label_0 = 'Assigned to you';
			label_1 = 'Created by you';
			label_2 = 'Your team\'s tasks';
			return '<button class="button button-outline bg-color-white ' +className+'">'+window['label_'+index]+'</button>';
        },
      },
	  on: {
		init: function(){
			setTimeout(function(){
			swiper.updateAutoHeight();
			$('.swiper-pagination-bullet-active').removeClass('bg-color-white');
			if(initialScroll){
				$('.page-content').scrollTop( $('.'+initialScroll).offset().top - 234 , 0)
				$('.'+initialScroll).addClass('highlight');
			}
			}, 1);
		},
		slideChange: function () {
			$('.swiper-pagination-bullet').addClass('bg-color-white');
			$('.swiper-pagination-bullet-active').removeClass('bg-color-white');
		},
	  },
    });
		},
	pageAfterIn: function(e, page){
		app.views[this.$app.views.current.name].router.currentPageEl.f7Component.methods.get_team_tasks();
	},
	},
    methods: {
		get_team_tasks: function(){
			$('.your-team-tasks .preloader').show();
			$('.your-team-tasks p, .your-team-tasks .button').hide();
			setTimeout(function(){http_api__post({methods:app.views.current.name,goto:app.views.current.name,onAlertCallback:'get_team_tasks_failure'},'silent',{todo: 'get_team_tasks', team: app.data.warrior.team, email: app.data.warrior.email});},1000);
		},
		get_team_tasks_failure: function(view,arguments){
			var app = this.$app;
			$('.your-team-tasks .preloader').hide();
			$('.your-team-tasks p').text('Sorry! we couldn\'t load your team\'s tasks. Please retry.');
			$('.your-team-tasks p, .your-team-tasks .button').show();
		},
		get_team_tasks_success: function(view,arguments){
			$('.your-team-tasks .preloader').hide();
			$('.your-team-tasks p, .your-team-tasks .button').show();
			if(arguments==''){$('.your-team-tasks p').text('Your team doesn\'t seem to any tasks listed on JCD.');return false;}

			var html = '';
			for (var i = 1; i < arguments.length; i++) {
				html += '<li><a data-goto="view/?id='+arguments[i].id+'" class="item-link item-content"> <div class="item-media"><div class="img" style="background-image:url('+app.data.config.file_server+'user/'+arguments[i].assigned_to_email+'.jpg)"></div></div> <div class="item-inner"> <div class="item-title"> <div class="item-header">'+arguments[i].assigned_to_name+'<i></i>'+Template7.helpers.t7helper_formatedDate(arguments[i].timestamp_created,0)+'</div> '+arguments[i].title+' </div> <div class="item-after"><span class="badge color-'+arguments[i].status+'">'+arguments[i].status+'</span></div> </div> </a> </li>';
			}

			$('.your-team-tasks .zero-tasks').remove();
			$('.your-team-tasks .list ul').append(html);
			var swiper = app.swiper.get('.swiper-container');
			swiper.updateAutoHeight();
		},
	},
  }
</script>

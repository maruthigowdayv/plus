<template>
	<div class="page">
		<div class="navbar">
			<div class="navbar-inner sliding">
				<div class="left">
					<a href="#" class="link back">
						<i class="icon icon-back"></i>
						<span class="ios-only">Back</span>
					</a>
				</div>
				<div class="title">Tasks<span class="subtitle"></span></div>
				{{#unless zero_tasks}}
				<div class="right">
				<a class="link icon-only searchbar-enable" data-searchbar=".searchbar-tasks">
				  <i class="icon material-icons md-only">search</i>
				  <i class="icon f7-icons ios-only">search_strong</i>
				</a>
			  </div>
			  {{/unless}}
			  
			   <form data-search-container=".search-list" data-search-in=".item-inner" class="searchbar searchbar-expandable searchbar-tasks searchbar-init">
				<div class="searchbar-inner">
				  <div class="searchbar-input-wrap">
					<input type="search" placeholder="Search tasks.."/>
					<i class="searchbar-icon"></i>
					<span class="input-clear-button"></span>
				  </div>
				  <span class="searchbar-disable-button">Cancel</span>
				</div>
			  </form>

			</div>
		</div>
		
		<div class="page-content">
		
		<div class="searchbar-backdrop"></div>
		
		<div class="block searchbar-hide-on-search"><p class="segmented"></p></div>
		
		<div class="list simple-list searchbar-not-found">
		  <ul>
			<li>Sorry, we couldn't find any tasks for this search.</li>
		  </ul>
		</div>				

		<div class="swiper-container"><div class="swiper-wrapper">

		<div class="swiper-slide">
			<div class="list search-list searchbar-found">
						{{#if zero_tasks}}
							<div class="zero-tasks"> 
							<br><br> <div class="img" style="background-image:url({{config.file_server}}user/{{warrior.reporting_to_email}}.jpg)"></div> <div class="zero-tasks-title">{{warrior.reporting_to_name}} <small>says</small><br>Well done, {{warrior.name}}!<br>You have 0 pending tasks.</div> <br><br> 
							</div>
						{{else}}
						<ul>
						{{#each tasks}}
							<li>
							  <a data-goto="view/?id={{this.id}}" class="item-link item-content" data-task-id="{{this.id}}">
								<div class="item-media"><div class="img" style='background-image:url({{js "return file_server + 'user/' + this.assigned_by_email + '.jpg'"}})'></div></div>
								<div class="item-inner">
								  <div class="item-title">
									<div class="item-header">{{this.assigned_by_name}}<i></i>{{t7helper_formatedDate this.timestamp_created 0}}</div>
									{{this.title}}
								  </div>
								  <div class="item-after"><span class="badge color-{{this.status}}">{{this.status}}</span></div>
								</div>
							  </a>
							</li>
						{{/each}}
						</ul>
						{{/if}}
						</div>
				</div>
			</div>
			
		<div class="swiper-slide">
			<div class="list search-list searchbar-found">
						{{#if zero_tasks}}
							<div class="zero-tasks"> 
							<br><br> <div class="img" style="background-image:url({{config.file_server}}user/{{warrior.reporting_to_email}}.jpg)"></div> <div class="zero-tasks-title">{{warrior.reporting_to_name}} <small>says</small><br>Well done, {{warrior.name}}!<br>You have 0 pending tasks.</div> <br><br> 
							</div>
						{{else}}
						<ul>
						{{#each tasks}}
							<li>
							  <a data-goto="view/?id={{this.id}}" class="item-link item-content" data-task-id="{{this.id}}">
								<div class="item-media"><div class="img" style='background-image:url({{js "return file_server + 'user/' + this.assigned_by_email + '.jpg'"}})'></div></div>
								<div class="item-inner">
								  <div class="item-title">
									<div class="item-header">{{this.assigned_by_name}}<i></i>{{t7helper_formatedDate this.timestamp_created 0}}</div>
									{{this.title}}
								  </div>
								  <div class="item-after"><span class="badge color-{{this.status}}">{{this.status}}</span></div>
								</div>
							  </a>
							</li>
						{{/each}}
						</ul>
						{{/if}}
						</div>
				</div>
			</div>

		<div class="swiper-slide">
			<div class="list search-list searchbar-found">
						{{#if zero_tasks}}
							<div class="zero-tasks"> 
							<br><br> <div class="img" style="background-image:url({{config.file_server}}user/{{warrior.reporting_to_email}}.jpg)"></div> <div class="zero-tasks-title">{{warrior.reporting_to_name}} <small>says</small><br>Well done, {{warrior.name}}!<br>You have 0 pending tasks.</div> <br><br> 
							</div>
						{{else}}
						<ul>
						{{#each tasks}}
							<li>
							  <a data-goto="view/?id={{this.id}}" class="item-link item-content" data-task-id="{{this.id}}">
								<div class="item-media"><div class="img" style='background-image:url({{js "return file_server + 'user/' + this.assigned_by_email + '.jpg'"}})'></div></div>
								<div class="item-inner">
								  <div class="item-title">
									<div class="item-header">{{this.assigned_by_name}}<i></i>{{t7helper_formatedDate this.timestamp_created 0}}</div>
									{{this.title}}
								  </div>
								  <div class="item-after"><span class="badge color-{{this.status}}">{{this.status}}</span></div>
								</div>
							  </a>
							</li>
						{{/each}}
						</ul>
						{{/if}}
						</div>
				</div>
			</div>

			</div></div>
			
		</div>
	</div>
</template>

<style scoped>
.item-header i:before {
	content: '';
	width: 4px;
	height: 4px;
	border-radius: 50%;
	display: inline-block;
	vertical-align: middle;
	margin: -1px 8px 0 8px;
	background: #757575;
}

.searchbar-backdrop {
	background: rgba(0,0,0,.1);
}

.item-media .img, .zero-tasks .img {
	width:36px;
	height:36px;
	background-size: 100% 100%;
	border-radius:50%;
	-moz-box-shadow: 0px 0px 2px 0px #000;
	-webkit-box-shadow: 0px 0px 2px 0px #000;
	box-shadow: 0px 0px 2px 0px #000;
	background-color: #ddd;
}

.zero-tasks {
	text-align: center;
	line-height: 36px;
}

.zero-tasks .img {
	width: 80px;
	height: 80px;
	margin: 0 auto 15px auto;
}

.zero-tasks small {
	color: grey;
}

.color-Pending {background:red}
.color-WIP {background:orange}
.color-Completed {background:green}

.item-after .badge {
    width: 68px;
	font-size: 12px;
}






.swiper-container {
  width: 100%;
  height: auto;
  min-height: 100%;
}

.swiper-slide .list{
	margin: 0;
}

swiper-pagination-bullet{
	opacity: 1!important;
}

.swiper-pagination-bullet-active{
	color: #fff!important;
}



</style>

<script>
file_server = app.data.config.file_server;

return	{
	data: function () {
        return {
			config: app.data.config,
			warrior: app.data.warrior,
			zero_tasks: function(){ if(app.form.getFormData('tasks').length==0){return 'zero';}else{return null} },
			tasks: app.form.getFormData('tasks'),
        }
    },
	on: {
		pageInit: function(){
			initialSlide = 0;
			initialScroll = '';
			initialOpen = '';
			if(this.$route.query.goto){initialSlide=this.$route.query.goto}
			if(this.$route.query.focus){initialScroll=this.$route.query.focus}
			if(this.$route.query.open){initialOpen=this.$route.query.open}
			
			var swiper = new Swiper('.swiper-container', {
			initialSlide: initialSlide,
			autoHeight: true,
			spaceBetween: 20,
			mousewheel: true,
			keyboard: {
			enabled: true,
			},
			pagination: {
			el: '.segmented',
			clickable: true,
			renderBullet: function (index, className) {
				label_0 = 'Assigned to you';
				label_1 = 'Created by you';
				label_2 = 'Team';
				return '<button class="button button-outline bg-color-white ' +className+'">'+window['label_'+index]+'</button>';
			},
			},
			on: {
			init: function(){
				setTimeout(function(){
				swiper.updateAutoHeight();
				$('.swiper-pagination-bullet-active').removeClass('bg-color-white');
				if(initialScroll){
					$('.page-content').scrollTop( $('.'+initialScroll).offset().top - 234 , 0)
					$('.'+initialScroll).addClass('highlight');
				}
				}, 1);
			},
			slideChange: function () {
				$('.swiper-pagination-bullet').addClass('bg-color-white');
				$('.swiper-pagination-bullet-active').removeClass('bg-color-white');
			},
			},
			});

		},
	},
    methods: {
		filterByTaskStatus(e){
        var $ = this.$;
        var app = this.$app;
		alert($(e.target).val())
		},
		
		deleteChip(e) {
        var $ = this.$;
        var app = this.$app;
        app.dialog.confirm('Do you want to delete this tiny demo Chip?', function () {
          $(e.target).parents('.chip').remove();
        });
      }, 
    },	  
}
</script>

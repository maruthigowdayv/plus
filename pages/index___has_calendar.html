<template>
	<div class="page">
		<div class="navbar">
			<div class="navbar-inner sliding">
				<div class="left">
					<a href="#" class="link back">
						<i class="icon icon-back"></i>
						<span class="ios-only">Back</span>
					</a>
				</div>
				<div class="title">Tasks<span class="subtitle"></span></div>
				<div class="right">
				<a class="link icon-only searchbar-enable" data-searchbar=".searchbar-tasks">
				  <i class="icon material-icons md-only">search</i>
				  <i class="icon f7-icons ios-only">search_strong</i>
				</a>
				<a class="link icon-only smart-select smart-select-init" data-open-in="popover" data-close-on-select="true">
				    <select name="status" multiple>
					  <option value="pending">Pending</option>
					  <option value="wip">Work-in-progress</option>
					  <option value="completed">Completed</option>
					</select>
				  <i class="icon material-icons">more</i>
				</a>
				<a class="link icon-only calendar-open">
				  <input type="hidden" readonly="readonly" id="tasks-calendar-range"/>
				  <i class="icon material-icons md-only">perm_contact_calendar</i>
				  <i class="icon f7-icons ios-only">calendar</i>
				</a>
			  </div>

			   <form data-search-container=".search-list" data-search-in=".item-inner" class="searchbar searchbar-expandable searchbar-tasks searchbar-init">
				<div class="searchbar-inner">
				  <div class="searchbar-input-wrap">
					<input type="search" placeholder="Search tasks.."/>
					<i class="searchbar-icon"></i>
					<span class="input-clear-button"></span>
				  </div>
				  <span class="searchbar-disable-button">Cancel</span>
				</div>
			  </form>
			  
			</div>
		</div>
		<div class="page-content">
			
		<div class="searchbar-backdrop"></div>
		
		<div class="list simple-list searchbar-not-found">
		  <ul>
			<li>Sorry, we couldn't find any tasks for this search.</li>
		  </ul>
		</div>

			<div class="block searchbar-hide-on-search">
				<div class="chip"><div class="chip-label">Pending</div><a href="#" class="chip-delete" @click="deleteChip"></a></div>
				<div class="chip"><div class="chip-label">Work-in-progress</div><a href="#" class="chip-delete" @click="deleteChip"></a></div>
				<div class="chip"><div class="chip-label">Completed</div><a href="#" class="chip-delete" @click="deleteChip"></a></div>
			</div>
			
				<div class="list search-list">
					<ul>
					{{zero_tasks}}
					{{#each tasks}}
						<li>
						  <a data-goto="view/?id={{this.id}}" class="item-link item-content" data-task-id="{{this.id}}">
							<div class="item-media"><div class="img" style='background-image:url({{js "return file_server + 'user/' + this.assigned_by_email + '.jpg'"}})'></div></div>
							<div class="item-inner">
							  <div class="item-title">
								<div class="item-header">{{js 'date=new Date(this.timestamp_created);months=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];return this.assigned_by_name + "<i></i>" + ("0" + date.getDate()).slice(-2) + " " + months[(date.getMonth() + 1)] + " " + date.getFullYear() + ", " + ("0" + date.getHours()).slice(-2) + ":" + ("0" + date.getMinutes()).slice(-2) +" "+ this.timestamp_created.split(" ")[2] '}}</div>
								{{this.title}}
							  </div>
							  <div class="item-after"><span class="badge color-{{this.status}}">{{this.status}}</span></div>
							</div>
						  </a>
						</li>
					{{/each}}
					</ul>
			</div>
			
			</div>
		</div>
	</div>
</template>

<style scoped>

.block {
    margin: 4px 0 -30px 0;
	min-height: 20px;
}

.badge.color-Pending{background:red;}
.badge.color-WIP{background:orange;}
.badge.color-Completed{background:green;}

.ios {{this}} .modal-in {
    margin: 702px 0 0 2px!important;
}

.item-media .img {
	width:36px;
	height:36px;
	background-size: 36px 36px;
	border-radius:50%;
	-moz-box-shadow: 0px 0px 2px 0px #000;
	-webkit-box-shadow: 0px 0px 2px 0px #000;
	box-shadow: 0px 0px 2px 0px #000;
	background-color: #ddd;
}

.zero-tasks {
	text-align: center;
	line-height: 36px;
}

.zero-tasks .img {
	margin: 0 auto 10px auto;
}

.zero-tasks small {
	color: grey;
}

.swiper-container {
  width: 100%;
  height: auto;
}

.swiper-container {
    min-height: 100%;
}

.swiper-slide .list{
	margin: 0;
}

.swiper-pagination-bullet{
	opacity: 1!important;
}

.swiper-pagination-bullet-active{
	color: #fff!important;
}

.item-header i:before {
	content: '';
	width: 4px;
	height: 4px;
	border-radius: 50%;
	display: inline-block;
	vertical-align: middle;
	margin: -1px 8px 0 8px;
	background: #757575;
}

.searchbar-found.toggle-swiper-slides .swiper-wrapper{
	display: inline!important;
}

.searchbar-found.toggle-swiper-slides .swiper-wrapper .list .item-inner:after {
	content: ''!important;
    position: absolute!important;
    background-color: rgba(0,0,0,.12)!important;
    display: block!important;
    z-index: 15!important;
    top: auto!important;
    right: auto!important;
    bottom: 0!important;
    left: 0!important;
    height: 1px!important;
    width: 100%!important;
    -webkit-transform-origin: 50% 100%!important;
    transform-origin: 50% 100%!important;
}

.searchbar-found.toggle-swiper-slides .swiper-wrapper .hidden-by-searchbar:after,
.searchbar-found.toggle-swiper-slides .swiper-wrapper .list ul:before,
.searchbar-found.toggle-swiper-slides .swiper-wrapper .list ul:after {
	display:none!important;
}

.searchbar-backdrop {
	background: rgba(0,0,0,.1);
}

#tasks-calendar-range {
	background: none;
    border: 0;
    color: #fff;
    font-size: 13px;
	padding: 0;
	margin: 0;
}
</style>

<script>

file_server = app.data.config.file_server;

setTimeout(function(){

var searchbar = app.searchbar.get('.searchbar-tasks');
searchbar.on('search', function(e,a){
	if( $('.searchbar-backdrop-in').length == 0 ){searchbar.$foundEl.addClass('toggle-swiper-slides');}else{searchbar.$foundEl.removeClass('toggle-swiper-slides');}
});
searchbar.on('disable', function(e,a){
	searchbar.$foundEl.removeClass('toggle-swiper-slides');
});

var smartSelect = app.smartSelect.get('.smart-select');
smartSelect.on('close', function(e){
	searchbar.search(e.$valueEl[0].innerText);
});


},10)

return	{
	data: function () {
        return {
			zero_tasks: function(){ if(app.form.getFormData('tasks').length==0){ return '<div class="zero-tasks"> <br><br> <div class="img" style="background-image:url(' + file_server + 'user/' + app.data.warrior.reporting_to_email + '.jpg)"></div> <div class="zero-tasks-title">'+app.data.warrior.reporting_to_name+' <small>says</small><br>Well done '+ app.data.warrior.name +'!<br>You have 0 pending tasks. </div> <br><br> </div>'}else{return ''}},
			tasks: app.form.getFormData('tasks'),
        }
    },
	on: {
		pageInit: function(){
			var self = this;
			var today = new Date();
			var app = self.$app;
			var $ = self.$;
			self.calendarRange = app.calendar.create({
			  inputEl: '#tasks-calendar-range',
			  dateFormat: 'dd M yyyy',
			  rangePicker: true,
			  openIn: 'customModal',
			  header: true,
			  footer: true,
			  toolbarCloseText: 'Filter Tasks',
			  on:{
				closed: function (calendar) {
					if(calendar.value){$('.subtitle').text($('#tasks-calendar-range').val().replace('-','â€”'))}
					app.dialog.alert('The calendar feature is getting built into tasks module. Please give us sometime to have everything built.', 'We\'re sorry, Warrior!')
				}
			  }
			});
			
			
			initialSlide = 0;
			initialScroll = '';
			initialOpen = '';
			if(this.$route.query.goto){initialSlide=this.$route.query.goto}
			if(this.$route.query.focus){initialScroll=this.$route.query.focus}
			if(this.$route.query.open){initialOpen=this.$route.query.open}

			
			$('.calendar-open').click(function(){
				self.calendarRange.open()
			})
			
var swiper = new Swiper('.swiper-container', {
	  initialSlide: initialSlide,
      autoHeight: true,
      spaceBetween: 20,
	  mousewheel: true,
      keyboard: {
        enabled: true,
      },
	  pagination: {
        el: '.segmented',
        clickable: true,
		renderBullet: function (index, className) {
			label_0 = 'Pending';
			label_1 = 'In-Progress';
			label_2 = 'Completed';
			return '<button class="button button-outline bg-color-white ' +className+'">'+window['label_'+index]+'</button>';
        },
      },
	  on: {
		init: function(){
			setTimeout(function(){
			swiper.updateAutoHeight();
			$('.swiper-pagination-bullet-active').removeClass('bg-color-white');
			if(initialScroll){
				$('.page-content').scrollTop( $('.'+initialScroll).offset().top - 234 , 0)
				$('.'+initialScroll).addClass('highlight');
			}
			}, 1);
		},
		slideChange: function () {
			$('.swiper-pagination-bullet').addClass('bg-color-white');
			$('.swiper-pagination-bullet-active').removeClass('bg-color-white');
		},
	  },
    });
		},


	},
    methods: {
		filterByTaskStatus(e){
        var $ = this.$;
        var app = this.$app;
		alert($(e.target).val())
		},
		
		deleteChip(e) {
        var $ = this.$;
        var app = this.$app;
        app.dialog.confirm('Do you want to delete this tiny demo Chip?', function () {
          $(e.target).parents('.chip').remove();
        });
      }
	},
  }
</script>
